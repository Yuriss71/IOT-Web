<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>MQTT Demo</title>
  </head>
  <body>
    <h2>MQTT Dashboard (ultra simple)</h2>
    <div id="status">Connecting...</div>
    <pre id="log"></pre>

    <script>
      const ws = new WebSocket(
        (location.protocol === "https:" ? "wss://" : "ws://") + location.host + "/ws"
      );
      ws.onopen = () => (document.getElementById("status").textContent = "Connected");
      ws.onclose = () => (document.getElementById("status").textContent = "Disconnected");
      ws.onmessage = (e) => {
        const d = JSON.parse(e.data);
        const line = `[${new Date(d.ts * 1000).toLocaleTimeString()}] ${d.topic} -> ${d.payload}\n`;
        document.getElementById("log").textContent = line + document.getElementById("log").textContent;
      };
      setInterval(() => ws.readyState === 1 && ws.send("ping"), 15000);
    </script>
  </body>
</html>
